Object : Based on the given purchase doc numbers, to display the purchase document numbers, document dates & vendor numbers by using ALV . If the user clicks on any purchasing document number only then we display the all the purchasing document item details by using ALV,if the user clicks on any vendor number only then we display the vendor details(LIFNR NAME1 ORT01).





REPORT ZRS_ALV_8.

TYPE-POOLS SLIS.
TABLES EKKO.
SELECT-OPTIONS S_EBELN FOR EKKO-EBELN.

TYPES : BEGIN OF TY_EKKO,
        EBELN TYPE EKKO-EBELN,
        BEDAT TYPE EKKO-BEDAT,
        LIFNR TYPE EKKO-LIFNR,
        END OF TY_EKKO.

DATA IT_EKKO TYPE TABLE OF TY_EKKO.

SELECT EBELN BEDAT LIFNR FROM EKKO INTO TABLE IT_EKKO WHERE EBELN IN S_EBELN.

DATA : IT_FCAT TYPE SLIS_T_FIELDCAT_ALV,
       WA_FCAT LIKE LINE OF IT_FCAT.

WA_FCAT-FIELDNAME = 'EBELN'.
WA_FCAT-COL_POS   = '1'.
WA_FCAT-SELTEXT_L = 'PUR.DOC.NO.'.
APPEND WA_FCAT TO IT_FCAT.
CLEAR WA_FCAT.

WA_FCAT-FIELDNAME = 'BEDAT'.
WA_FCAT-COL_POS   = '2'.
WA_FCAT-SELTEXT_L = 'DOC. DATE'.
* BELOW TWO FIELDS SHOWN DATE (BEDAT) PROPERLY.
WA_FCAT-REF_TABNAME = 'EKKO'.
WA_FCAT-FIELDNAME  = 'BEDAT'.
APPEND WA_FCAT TO IT_FCAT.
CLEAR WA_FCAT.

WA_FCAT-FIELDNAME = 'LIFNR'.
WA_FCAT-COL_POS   = '3'.
WA_FCAT-SELTEXT_L = 'VENDOR'.
APPEND WA_FCAT TO IT_FCAT.
CLEAR WA_FCAT.

DATA : IT_EVENT TYPE SLIS_T_EVENT,
       WA_EVENT LIKE LINE OF IT_EVENT.

WA_EVENT-NAME = 'USER_COMMAND'.
WA_EVENT-FORM = 'UC'.
APPEND WA_EVENT TO IT_EVENT.

CALL FUNCTION 'REUSE_ALV_LIST_DISPLAY'
 EXPORTING

  I_CALLBACK_PROGRAM             = 'ZRS_ALV_8'
   IT_FIELDCAT                    = IT_FCAT
   IT_EVENTS                     = IT_EVENT
  TABLES
    t_outtab                       = IT_EKKO.

FORM UC USING A LIKE SY-UCOMM B TYPE SLIS_SELFIELD.
  IF B-FIELDNAME = 'EBELN'.

    DATA IT_EKPO LIKE TABLE OF EKPO.
    SELECT * FROM EKPO INTO TABLE IT_EKPO WHERE EBELN = B-VALUE.
    CALL FUNCTION 'REUSE_ALV_LIST_DISPLAY'
       EXPORTING
        I_STRUCTURE_NAME     = 'EKPO'

      TABLES
        t_outtab             = IT_EKPO.



  ELSEIF B-FIELDNAME = 'LIFNR'.

    DATA V1 TYPE LFA1-LIFNR.
    TYPES : BEGIN OF TY_LFA1,
            LIFNR TYPE LFA1-LIFNR,
            NAME1 TYPE LFA1-NAME1,
            ORT01 TYPE LFA1-ORT01,
            END OF TY_LFA1.

    DATA IT_LFA1 TYPE TABLE OF TY_LFA1.
    V1 = B-VALUE.
    CALL FUNCTION 'CONVERSION_EXIT_ALPHA_INPUT'
      EXPORTING
        input         = V1
     IMPORTING
      OUTPUT          = V1.



    SELECT LIFNR NAME1 ORT01 FROM LFA1 INTO TABLE IT_LFA1 WHERE LIFNR = V1.

    DATA : IT_FCAT1 TYPE SLIS_T_FIELDCAT_ALV,
           WA_FCAT1 LIKE LINE OF IT_FCAT1.

      WA_FCAT-FIELDNAME = 'LIFNR'.
      WA_FCAT-COL_POS   = '1'.
      WA_FCAT-SELTEXT_M = 'VANDOR'.
      APPEND WA_FCAT1 TO IT_FCAT1.
      CLEAR WA_FCAT1.

      WA_FCAT-FIELDNAME = 'NAME1'.
      WA_FCAT-COL_POS   = '2'.
      WA_FCAT-SELTEXT_M = 'VENDOR NAME'.
      APPEND WA_FCAT1 TO IT_FCAT1.
      CLEAR WA_FCAT1.

      WA_FCAT-FIELDNAME = 'ORT01'.
      WA_FCAT-COL_POS   = '3'.
      WA_FCAT-SELTEXT_M = 'CITY'.
      APPEND WA_FCAT1 TO IT_FCAT1.
      CLEAR WA_FCAT1.



CALL FUNCTION 'REUSE_ALV_LIST_DISPLAY'
 EXPORTING

   IT_FIELDCAT        = IT_FCAT1

  TABLES
    t_outtab          = IT_LFA1.




 ENDIF.
ENDFORM.